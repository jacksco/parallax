function loadFollowing(){function a(a){$("div.listitempage:last").after(a.response),next_data_url=a.next_data_url,next_data_cache=!1,$.getJSON(next_data_url,function(a){next_data_cache=a,console.log("next_data_cache")})}""==next_data_url?(console.log("show pagination"),$("div.pagination").show()):(console.log("hide pagination"),is_loading=1,$("div.pagination").hide(),next_data_cache?(a(next_data_cache),is_loading=0):$.getJSON(next_data_url,function(t){a(t),is_loading=0}))}function loadPrevious(){function a(a){$("div.listitempage:first").before(a.response),item_height=$("div.listitempage:first").height(),window.scrollTo(0,$(window).scrollTop()+item_height),prev_data_url=a.prev_data_url,prev_data_cache=!1,$.getJSON(prev_data_url,function(a){prev_data_cache=a}),hide_on_load&&($(hide_on_load).hide(),hide_on_load=!1)}""==prev_data_url?$("div.pagination").show():(is_loading=1,$("div.pagination").hide(),prev_data_cache?(a(prev_data_cache),is_loading=0):$.getJSON(prev_data_url,function(t){a(t),is_loading=0}))}function mostlyVisible(a){var t=$(window).scrollTop(),i=$(window).height(),e=$(a).offset().top,n=$(a).height(),o=e+n;return o-.25*n>t&&t+.5*i>e}function initPaginator(){$(window).scroll(function(){var a=$(window).scrollTop();a>=.9*($(document).height()-$(window).height())&&0==is_loading&&loadFollowing(),a<=.9*$("#header").height()&&0==is_loading&&loadPrevious(),Math.abs(a-last_scroll)>.1*$(window).height()&&(last_scroll=a,$(".listitempage").each(function(){return mostlyVisible(this)?(history.replaceState(null,null,$(this).attr("data-url")),$("#pagination").html($(this).attr("data-pagination")),!1):void 0}))}),$(document).ready(function(){if($(window).height()>$("#container").height())if(console.log("test"),""!=next_data_url)loadFollowing();else{var a=document.createElement("div");a.id="filler",a.style.height=$(window).height()-$("#container").height()+"px",$("#container").after(a),hide_on_load="filler"}head_height=$("#header").height(),window.scrollTo(0,head_height)})}function primeCache(){$.getJSON(prev_data_url,function(a){prev_data_cache=a}),$.getJSON(next_data_url,function(a){next_data_cache=a})}var next_data_url,prev_data_url,next_data_cache,prev_data_cache,last_scroll=0,is_loading=0,hide_on_load=!1;